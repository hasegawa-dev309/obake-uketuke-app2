import{r as a,j as e,c as S}from"./index-DH51pi5z.js";import{N,O as k,H as C,R as I,a as v}from"./index-DW6L4wlq.js";function T({title:s,titleId:i,...o},u){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":i},o),s?a.createElement("title",{id:i},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const _=a.forwardRef(T);function E(){return e.jsxs("div",{className:"min-h-screen bg-slate-50 flex",children:[e.jsxs("aside",{className:"w-64 border-r bg-white",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-lg bg-violet-600 text-white",children:"👻"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-lg",children:"お化け屋敷"}),e.jsx("div",{className:"text-xs text-slate-500",children:"整理券システム"})]})]})}),e.jsxs("nav",{className:"p-4 space-y-2",children:[e.jsxs(N,{to:"/",end:!0,className:({isActive:s})=>`flex items-center gap-3 px-3 py-2 rounded-lg transition-colors ${s?"bg-violet-100 text-violet-700":"hover:bg-gray-100"}`,children:[e.jsx("span",{className:"text-lg",children:"🎫"}),e.jsx("span",{children:"整理券管理"})]}),e.jsxs(N,{to:"/call",className:({isActive:s})=>`flex items-center gap-3 px-3 py-2 rounded-lg transition-colors ${s?"bg-violet-100 text-violet-700":"hover:bg-gray-100"}`,children:[e.jsx("span",{className:"text-lg",children:"👤"}),e.jsx("span",{children:"呼び出し管理"})]}),e.jsxs(N,{to:"/issue",className:({isActive:s})=>`flex items-center gap-3 px-3 py-2 rounded-lg transition-colors ${s?"bg-violet-100 text-violet-700":"hover:bg-gray-100"}`,children:[e.jsx("span",{className:"text-lg",children:"➕"}),e.jsx("span",{children:"整理券発行"})]}),e.jsxs(N,{to:"/settings",className:({isActive:s})=>`flex items-center gap-3 px-3 py-2 rounded-lg transition-colors ${s?"bg-violet-100 text-violet-700":"hover:bg-gray-100"}`,children:[e.jsx("span",{className:"text-lg",children:"⚙️"}),e.jsx("span",{children:"設定"})]})]})]}),e.jsx("main",{className:"flex-1 p-6",children:e.jsx(k,{})})]})}function y(){const[s,i]=a.useState([]),[o,u]=a.useState(""),[h,b]=a.useState("すべて"),[g,j]=a.useState("すべて");a.useEffect(()=>{const t=JSON.parse(localStorage.getItem("admin_tickets")||"[]");i(t)},[]),a.useEffect(()=>{const t=()=>{const d=JSON.parse(localStorage.getItem("admin_tickets")||"[]");i(d)},l=()=>{t()};window.addEventListener("storage",t),window.addEventListener("ticketAdded",l);const r=setInterval(t,1e3);return()=>{window.removeEventListener("storage",t),window.removeEventListener("ticketAdded",l),clearInterval(r)}},[]);const p=s.filter(t=>{const l=t.id.toLowerCase().includes(o.toLowerCase())||t.email.toLowerCase().includes(o.toLowerCase())||t.count.toString().includes(o),r=h==="すべて"||t.age===h,d=g==="すべて"||t.status===g;return l&&r&&d}),n=t=>s.filter(l=>l.status===t).length,c=(t,l)=>{const r=s.map(d=>d.id===t?{...d,status:l}:d);i(r),localStorage.setItem("admin_tickets",JSON.stringify(r))},x=()=>{const t=[["整理券番号","メール","人数","年齢層","来場状況","登録時間"],...p.map(m=>[m.id,m.email,m.count.toString(),m.age,m.status,m.createdAt])].map(m=>m.join(",")).join(`
`),l=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),d=URL.createObjectURL(l);r.setAttribute("href",d),r.setAttribute("download",`整理券データ_${new Date().toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold",children:"整理券管理"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"text",placeholder:"検索...",className:"px-3 py-2 border rounded-lg w-64",value:o,onChange:t=>u(t.target.value)}),e.jsxs("button",{onClick:()=>{const t=JSON.parse(localStorage.getItem("admin_tickets")||"[]");i(t)},className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg flex items-center gap-2",title:"データを再読み込み",children:[e.jsx("span",{children:"🔄"}),"リロード"]}),e.jsx("button",{onClick:x,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg",children:"エクスポート"}),e.jsxs("button",{className:"px-4 py-2 bg-gray-500 text-white rounded-lg flex items-center gap-2",children:[e.jsx("span",{children:"👤"}),"管理者"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-slate-600",children:"未呼出"}),e.jsx("div",{className:"text-slate-400",children:"🎫"})]}),e.jsx("div",{className:"mt-3 text-3xl font-bold",children:n("未呼出")})]}),e.jsxs("div",{className:"bg-white rounded-xl border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-slate-600",children:"来場済"}),e.jsx("div",{className:"text-slate-400",children:"👤"})]}),e.jsx("div",{className:"mt-3 text-3xl font-bold",children:n("来場済")})]}),e.jsxs("div",{className:"bg-white rounded-xl border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-slate-600",children:"未確認"}),e.jsx("div",{className:"text-slate-400",children:"🕐"})]}),e.jsx("div",{className:"mt-3 text-3xl font-bold",children:n("未確認")})]})]}),e.jsx("div",{className:"bg-white rounded-xl border p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{className:"px-3 py-2 border rounded-lg",value:h,onChange:t=>b(t.target.value),children:[e.jsx("option",{value:"すべて",children:"年齢層: すべて"}),e.jsx("option",{value:"高校生以下",children:"高校生以下"}),e.jsx("option",{value:"大学生",children:"大学生"}),e.jsx("option",{value:"一般",children:"一般"})]}),e.jsxs("select",{className:"px-3 py-2 border rounded-lg",value:g,onChange:t=>j(t.target.value),children:[e.jsx("option",{value:"すべて",children:"状態: すべて"}),e.jsx("option",{value:"未呼出",children:"未呼出"}),e.jsx("option",{value:"来場済",children:"来場済"}),e.jsx("option",{value:"未確認",children:"未確認"})]}),e.jsx("input",{type:"text",placeholder:"整理券番号・メール・人数",className:"px-3 py-2 border rounded-lg flex-1",value:o,onChange:t=>u(t.target.value)}),e.jsx("button",{onClick:x,className:"px-4 py-2 bg-green-500 text-white rounded-lg",children:"エクスポート (CSV)"})]})}),e.jsx("div",{className:"bg-white rounded-xl border overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"整理券番号"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"メールアドレス"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"人数"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"年齢層"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"来場状況"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"登録時間"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"操作"})]})}),e.jsxs("tbody",{children:[p.map((t,l)=>e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"px-3 py-2 font-mono text-sm font-bold text-violet-600",children:["#",t.ticketNo||t.id]}),e.jsx("td",{className:"px-3 py-2",children:t.email}),e.jsxs("td",{className:"px-3 py-2",children:[t.count,"名"]}),e.jsx("td",{className:"px-3 py-2",children:t.age}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.status==="未確認"?"bg-yellow-100 text-yellow-700":t.status==="未呼出"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:t.status})}),e.jsx("td",{className:"px-3 py-2",children:t.createdAt}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(t.id,"来場済"),className:"px-2 py-1 bg-green-100 text-green-700 rounded text-xs hover:bg-green-200",children:"来場済"}),e.jsx("button",{onClick:()=>c(t.id,"未呼出"),className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200",children:"未呼出"}),e.jsx("button",{onClick:()=>c(t.id,"未確認"),className:"px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs hover:bg-yellow-200",children:"未確認"})]})})]},`${t.id}-${l}`)),!p.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center text-slate-500 py-8",children:"データがありません"})})]})]})})]})}function $(){const[s,i]=a.useState(Number(localStorage.getItem("current_number")??"1")),[o,u]=a.useState(localStorage.getItem("system_paused")==="true"),[h,b]=a.useState([]);a.useEffect(()=>{localStorage.setItem("current_number",String(s))},[s]),a.useEffect(()=>{localStorage.setItem("system_paused",String(o))},[o]),a.useEffect(()=>{const n=()=>{const x=JSON.parse(localStorage.getItem("admin_tickets")||"[]");b(x)};n();const c=setInterval(n,1e3);return()=>clearInterval(c)},[]);const g=()=>{const n=Number(localStorage.getItem("current_number")??"1");i(n);const c=JSON.parse(localStorage.getItem("admin_tickets")||"[]");b(c)},j=()=>{const n=h.find(t=>t.ticketNo===String(s)||t.id===String(s));if(!n){alert("該当する整理券が見つかりません");return}const c=encodeURIComponent("お化け屋敷：順番のお知らせ"),x=encodeURIComponent(`整理券番号 ${s} のお客様

まもなく順番となります。受付までお越しください。

お化け屋敷スタッフ`);window.open(`mailto:${n.email}?subject=${c}&body=${x}`)},p=()=>{const n=h.filter(l=>{const r=Number(l.ticketNo||l.id);return r>s&&r<=s+5});if(n.length===0){alert("次の5組の整理券が見つかりません");return}const c=n.map(l=>l.email).join(","),x=encodeURIComponent("お化け屋敷：まもなくお呼びします"),t=encodeURIComponent(`お化け屋敷の整理券をお持ちのお客様

現在の呼び出し番号は ${s} です。
まもなくお呼びしますので、受付付近でお待ちください。

お化け屋敷スタッフ`);window.open(`mailto:${c}?subject=${x}&body=${t}`)};return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h1",{className:"text-xl font-bold",children:"呼び出し管理"}),e.jsxs("button",{onClick:g,className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg flex items-center gap-2",title:"データを再読み込み",children:[e.jsx("span",{children:"🔄"}),"リロード"]})]}),e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"text-6xl font-bold text-violet-600 mb-4",children:s}),e.jsx("div",{className:"text-lg text-slate-600",children:o?"一時停止中":"呼び出し中"})]}),e.jsxs("div",{className:"flex justify-center items-center gap-8 mb-8",children:[e.jsx("button",{className:"w-16 h-16 rounded-full border-2 border-gray-300 hover:border-violet-500 hover:bg-violet-50 flex items-center justify-center text-2xl transition-colors",onClick:()=>i(n=>Math.max(1,n-1)),children:"◀"}),e.jsx("div",{className:"text-4xl font-bold text-center min-w-[120px]",children:s}),e.jsx("button",{className:"w-16 h-16 rounded-full border-2 border-gray-300 hover:border-violet-500 hover:bg-violet-50 flex items-center justify-center text-2xl transition-colors",onClick:()=>i(n=>n+1),children:"▶"})]}),e.jsxs("div",{className:"flex justify-center gap-4 flex-wrap",children:[e.jsx("button",{className:`px-6 py-3 rounded-lg font-medium transition-colors ${o?"bg-green-500 hover:bg-green-600 text-white":"bg-yellow-500 hover:bg-yellow-600 text-white"}`,onClick:()=>u(n=>!n),children:o?"再開":"一時停止"}),e.jsx("button",{className:"px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",onClick:()=>i(1),children:"リセット"})]}),e.jsxs("div",{className:"flex justify-center gap-4 mt-6 flex-wrap",children:[e.jsxs("button",{className:"px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors flex items-center gap-2",onClick:j,children:[e.jsx("span",{children:"📧"}),"現在の番号にメール送信"]}),e.jsxs("button",{className:"px-6 py-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg font-medium transition-colors flex items-center gap-2",onClick:p,children:[e.jsx("span",{children:"📬"}),"次の5組にメール送信"]})]}),e.jsxs("div",{className:"mt-12 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl border p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-violet-600",children:s}),e.jsx("div",{className:"text-sm text-slate-600",children:"現在の番号"})]}),e.jsxs("div",{className:"bg-white rounded-xl border p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o?"⏸️":"▶️"}),e.jsx("div",{className:"text-sm text-slate-600",children:"状態"})]})]})]})}function R(){const[s,i]=a.useState(""),[o,u]=a.useState(1),[h,b]=a.useState("一般"),[g,j]=a.useState(!1),[p,n]=a.useState(null),[c,x]=a.useState(null);async function t(l){l.preventDefault(),j(!0),n(null);try{const d=parseInt(localStorage.getItem("ticket_counter")||"0")+1;localStorage.setItem("ticket_counter",d.toString()),x(d.toString());const m={id:d.toString(),email:s,count:o,age:h,status:"未呼出",createdAt:new Date().getTime(),ticketNo:d.toString()},f=JSON.parse(localStorage.getItem("admin_tickets")||"[]");f.unshift(m),localStorage.setItem("admin_tickets",JSON.stringify(f))}catch{n("整理券の発行に失敗しました")}finally{j(!1)}}return c?e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl border p-8 text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-2xl mb-4",children:"✓"}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"整理券発行完了"}),e.jsx("p",{className:"text-slate-600 mb-6",children:"整理券が正常に発行されました！"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm text-slate-500 mb-2",children:"整理券番号"}),e.jsx("div",{className:"text-5xl font-bold text-violet-600",children:c})]}),e.jsx("button",{onClick:()=>{x(null),i(""),u(1),b("一般")},className:"w-full bg-violet-600 hover:bg-violet-700 text-white py-3 rounded-xl font-medium transition-colors",children:"新しく整理券を発行する"})]})}):e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8",children:"整理券発行"}),e.jsxs("form",{onSubmit:t,className:"bg-white rounded-xl border p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"メールアドレス"}),e.jsx("input",{type:"email",value:s,onChange:l=>i(l.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"人数"}),e.jsx("select",{value:o,onChange:l=>u(Number(l.target.value)),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500",children:Array.from({length:10},(l,r)=>r+1).map(l=>e.jsxs("option",{value:l,children:[l,"名"]},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"年齢層"}),e.jsxs("select",{value:h,onChange:l=>b(l.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500",children:[e.jsx("option",{value:"一般",children:"一般"}),e.jsx("option",{value:"大学生",children:"大学生"}),e.jsx("option",{value:"高校生以下",children:"高校生以下"})]})]}),p&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:p}),e.jsx("button",{disabled:g,className:"w-full h-12 rounded-xl font-bold text-white bg-gradient-to-r from-rose-500 to-violet-600 disabled:opacity-50",children:g?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"発行中..."]}):e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"整理券を発行する"]})})]})]})}function A(){const s=()=>{confirm("すべての整理券データをクリアしますか？この操作は取り消せません。")&&(localStorage.removeItem("admin_tickets"),localStorage.removeItem("obake_tickets_v1"),localStorage.removeItem("lastTicketNumber"),localStorage.setItem("current_number","1"),localStorage.setItem("ticket_counter","0"),alert("データをクリアしました"),window.location.reload())},i=()=>{confirm("呼び出し番号と整理券番号を1にリセットしますか？")&&(localStorage.setItem("current_number","1"),localStorage.setItem("ticket_counter","0"),localStorage.removeItem("lastTicketNumber"),alert("呼び出し番号と整理券番号をリセットしました"),window.location.reload())};return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"設定"}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"システム操作"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("button",{onClick:i,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors",children:"呼び出し番号・整理券番号をリセット"}),e.jsx("p",{className:"text-sm text-slate-600 mt-2",children:"呼び出し番号と整理券番号を1に戻します"})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors",children:"すべてのデータをクリア"}),e.jsx("p",{className:"text-sm text-slate-600 mt-2",children:"⚠️ すべての整理券データと呼び出し番号が削除されます（取り消し不可）"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"システム情報"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-2",children:[e.jsxs("div",{children:["環境: ","production"]}),e.jsx("div",{children:"バージョン: 1.0.0"})]})]})]})}function L(){return e.jsx(C,{children:e.jsx(I,{children:e.jsxs(v,{path:"/",element:e.jsx(E,{}),children:[e.jsx(v,{index:!0,element:e.jsx(y,{})}),e.jsx(v,{path:"tickets",element:e.jsx(y,{})}),e.jsx(v,{path:"call",element:e.jsx($,{})}),e.jsx(v,{path:"issue",element:e.jsx(R,{})}),e.jsx(v,{path:"settings",element:e.jsx(A,{})})]})})})}const w=document.getElementById("admin-root");w&&S.createRoot(w).render(e.jsx(L,{}));
